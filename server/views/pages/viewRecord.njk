{% extends "../partials/layout.njk" %}
{% set pageTitle = "View and match learner record â€“ " + applicationName + " - GOV.UK" %}
{% set mainClasses = "app-container govuk-body" %}
{% set mainClasses = "govuk-main-wrapper--l" %}

{%- from "moj/components/ticket-panel/macro.njk" import mojTicketPanel -%}
{%- from "govuk/components/table/macro.njk" import govukTable -%}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% block content %}

<div class="govuk-width-container">

  <h1 class="govuk-heading-l">View and match learner record</h1>
  <p class="govuk-body">Information from Learning Records Service (LRS).</p>

  {% set panelContent %}
    <h2 class="govuk-heading-m">ULN: {{ learner.uln }}</h2>
    <div class="govuk-flex">
      <p class="govuk-body govuk-!-margin-right-3">Given name: {{ learner.givenName }}</p>
      <p class="govuk-body govuk-!-margin-right-3">Family name: {{ learner.familyName }}</p>
      <p class="govuk-body govuk-!-margin-right-3">Date of birth: {{ learner.dateOfBirth }} </p>
    </div>
    <div class="govuk-flex">
      <p class="govuk-body govuk-!-margin-right-3">Postcode: {{ learner.lastKnownPostCode }}</p>
      <p class="govuk-body govuk-!-margin-right-3">Sex: {{ learner.gender }}</p>
    </div>
  {% endset %}

  {{ mojTicketPanel({
    items: [{
      html: panelContent
    }]
  }) }}

  {% set tableRows = [] %}
  
  {% for record in learningEvents %}
    {% set row = [
      { text: record.subject },
      { text: record.awardingOrganisationName },
      { text: record.level or "Not Specified" },
      { text: record.grade },
      { text: record.achievementAwardDate }
    ] %}
    {% set tableRows = (tableRows.push(row), tableRows) %}
  {% endfor %}


  {{ govukTable({
    attributes: {
      "data-module": "moj-sortable-table"
    },
    head: [
      {
        text: "Subject",
        attributes: {
          "aria-sort": "none"
        }
      },
      {
        text: "Awarding body",
        attributes: {
          "aria-sort": "none"
        }
      },
      {
        text: "Level",
        attributes: {
          "aria-sort": "none"
        }
      },
      {
        text: "Grade",
        attributes: {
          "aria-sort": "none"
        }
      },
      {
        text: "Awarded on",
        attributes: {
          "aria-sort": "none"
        },
        format: "numeric"
      }
    ],
    rows: tableRows
  }) }}

  <h3 class="govuk-heading-m">Match this learner record to {{ prisoner.firstName }} {{ prisoner.lastName }}</h3>
  <p class="govuk-body">By clicking 'Match record' you will link the following prisoner and learner records:</p>

  {% set secondTableRows = [] %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      {{ govukTable({
        attributes: {
          "data-module": "moj-sortable-table"
        },
        head: [
          {
            text: "Prisoner",
            attributes: {
              "aria-sort": "none"
            }
          },
          {
            text: "LRS Record",
            attributes: {
              "aria-sort": "none"
            }
          }
        ],
        rows: [
          [
            { html: prisoner.firstName + " " + prisoner.lastName  + "<br>Prison number: " + prisoner.prisonerNumber },
            { html: learner.givenName + " " + learner.familyName  + "<br>ULN: " + learner.uln }
          ]
        ]
      }) }}
    </div>
  </div>

  <form action="#" method="post">
    <div class="govuk-button-group">
      {{ govukButton({
        text: "Match record",
        type: "submit"
      }) }}
      <a class="govuk-link" href="">Cancel and return to search</a>
    </div>  
    <input type="hidden" name="_csrf" value="{{ csrfToken }}">
  </form>

</div>

{% endblock %}